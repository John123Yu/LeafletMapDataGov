<!DOCTYPE html>
<html>
<head>
	<title>Data.gov Map of Open Government Websites</title>
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
	<link rel="stylesheet" href="./leaflet-search/src/leaflet-search.css" />
	<!-- <link href='https://api.mapbox.com/mapbox-gl-js/v0.34.0/mapbox-gl.css' rel='stylesheet' /> -->
	<!-- <script src='https://api.mapbox.com/mapbox-gl-js/v0.34.0/mapbox-gl.js'></script> -->
	<script src="https://code.jquery.com/jquery-3.2.1.js" integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE=" crossorigin="anonymous"></script>
	<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
	<script type="text/javascript" src="http://maps.stamen.com/js/tile.stamen.js?v1.3.0"></script>
	<script src="./leaflet-search/src/leaflet-search.js"></script>
	<script src="international.js"></script>
	<script src="us_states.js"></script>
	<script src="us_cities_counties.js"></script>
	<style type="text/css">
		#mapid { 
			height: 650px; 
			width: 990px;
			border: 1px solid #333333;
		}
		.leaflet-popup-content {
			font-weight: bold;
			line-height: 1.5em;
		}
	</style>
</head>
<body>
	<div id="mapid"></div>
</body>
<script type="text/javascript">
	var mymap = L.map('mapid').setView([40, 0], 1.5);
	var international, state, local;
	var myStyle = {
	    "color": "black",
	    "weight": 1,
	    "opacity": 0.8,
	    'fillColor': '#4679B2',
	    'fillOpacity': 0.7
	},
		blankStyle = {
			opacity: 0,
			fillOpacity: 0
		};
	var geoDatas = [{international: internationalGeoJson}, {state: statesGeoJson}, {local: localGeoJson}]

	var layer = new L.StamenTileLayer("toner-lite");
	var layer2 = L.tileLayer('http://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png', {
	    attribution: '<a href="http://www.openstreetmap.org/copyright">&#169; OpenStreetMap contributors</a>',
	    maxZoom: 15
	});
	mymap.addLayer(layer2);

	international = L.geoJSON(internationalGeoJson, {
	    style: myStyle,
	    onEachFeature: function(feature, layer) {
	    	layer.bindPopup('<h4>'+ feature.properties.Item +'</h4>' + "<h4>" + "<a target='blank' href='"+feature.properties.Link+"'>"+feature.properties.Link+"</a><h4>" );
		    layer.on({
		    	contextmenu: function(e){
		    		var popup = L.popup().setLatLng(e.latlng).setContent(feature.properties.Item  + "<br> Link: " + feature.properties.Link)
				    popup.openOn(mymap);
				},
                mouseover: function(e) {
                	layer.setStyle({
			            fillColor: 'orange',
			            fillOpacity: 0.6
			        })
                },
                mouseout: function (e) {
                	layer.setStyle({
			            fillColor: '#4679B2',
			            fillOpacity: 0.7
			        })
		        },
                click: function (e) {
		            window.open(feature.properties.Link,'_blank');
		        }
            });
		}
	})

	state = L.geoJSON(statesGeoJson, {
	    style: myStyle,
	    onEachFeature: function(feature, layer) {
	    	layer.bindPopup('<h4>'+ feature.properties.Item +'</h4>' + "<h4>" + "<a target='blank' href='"+feature.properties.Link+"'>"+feature.properties.Link+"</a><h4>" );
		    layer.on({
		    	contextmenu: function(e){
		    		var popup = L.popup().setLatLng(e.latlng).setContent(feature.properties.Item  + "<br> Link: " + feature.properties.Link)
				    popup.openOn(mymap);
				},
                mouseover: function(e) {
                	layer.setStyle({
			            fillColor: 'orange',
			            fillOpacity: 0.6
			        })
                },
                mouseout: function (e) {
                	layer.setStyle({
			            fillColor: '#4679B2',
			            fillOpacity: 0.7
			        })
		        },
                click: function (e) {
		            window.open(feature.properties.Link,'_blank');
		        }
            });
		}
	})

	local = L.geoJSON(localGeoJson, {
	    style: myStyle,
	    onEachFeature: function(feature, layer) {
	    	layer.bindPopup('<h4>'+ feature.properties.Item +'</h4>' + "<h4>" + "<a target='blank' href='"+feature.properties.Link+"'>"+feature.properties.Link+"</a><h4>" );
		    layer.on({
                mouseover: function(e) {
                	layer.setStyle({
			            fillColor: 'orange',
			            fillOpacity: 0.6
			        })
                },
                mouseout: function (e) {
                	layer.setStyle({
			            fillColor: '#4679B2',
			            fillOpacity: 0.7
			        })
		        }
            });
		}
	})

	var allGeoJson = L.geoJson([internationalGeoJson, localGeoJson, statesGeoJson], {
		style: blankStyle,
		onEachFeature: function(feature, layer) {
			layer.bindPopup('<h4>'+ feature.properties.Item +'</h4>' + "<h4>" + "<a target='blank' href='"+feature.properties.Link+"'>"+feature.properties.Link+"</a><h4>" );
			layer.on({
				contextmenu: function(e){
		    		var popup = L.popup().setLatLng(e.latlng).setContent(feature.properties.Item  + "<br> Link: " + feature.properties.Link)
				    popup.openOn(mymap);
				},
				mouseout: function (e) {
                	layer.setStyle({
			            fillColor: '#4679B2',
			            fillOpacity: 0
			        })
		        },
		        click: function (e) {
		            window.open(feature.properties.Link,'_blank');
		        }
            });
		}
	});

	var baseMaps = {
	    "Text Map": layer,
	    'Geographic Map': layer2
	};
	var overlayMaps = {
	    "International": international,
	    "State": state,
	    "US Cities and Counties": local
	};
	mymap.addLayer(international);
	mymap.addLayer(state);
	mymap.addLayer(local);
	L.control.layers(baseMaps, overlayMaps).addTo(mymap);

	var searchControl = new L.Control.Search({
		moveToLocation: function(latlng, title, map) {
			if(latlng.layer.getBounds){
				var zoom = map.getBoundsZoom(latlng.layer.getBounds());
			} else {
				var zoom = 6;
			}
  			map.setView(latlng, zoom); // access the zoom
		},
		position: 'topright',
		layer: allGeoJson,
		propertyName: 'Item',
		marker: false
	}).on('search:locationfound', function(e) {
		e.layer.setStyle({fillColor: 'orange', fillOpacity: .6});
		if(e.layer._popup){
			e.layer._popup._content=e.layer.feature.properties.Item+"<br> <a target='blank' href='"+e.layer.feature.properties.Link+"'>"+e.layer.feature.properties.Link+"</a>";
			e.layer.openPopup();
		}
	})
	mymap.addControl( searchControl );

</script>
</html>