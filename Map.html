<!DOCTYPE html>
<html>
<head>
	<title>Data.gov Map of Open Government Websites</title>
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
	<link src="./leaflet-fusesearch/src/leaflet.fusesearch.css"></link>
	<!-- <link href='https://api.mapbox.com/mapbox-gl-js/v0.34.0/mapbox-gl.css' rel='stylesheet' /> -->
	<script src="https://code.jquery.com/jquery-3.2.1.js" integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE=" crossorigin="anonymous"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
	<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
	<!-- <script src='https://api.mapbox.com/mapbox-gl-js/v0.34.0/mapbox-gl.js'></script> -->
	<script type="text/javascript" src="http://maps.stamen.com/js/tile.stamen.js?v1.3.0"></script>
	<script src="./Fuse/src/fuse.min.js"></script>
	<script src="./leaflet-fusesearch/src/leaflet.fusesearch.js"></script>
	<style type="text/css">
		#mapid { 
			height: 650px; 
			width: 990px;
			border: 1px solid #333333;
		}
		.leaflet-popup-content {
			font-weight: bold;
			line-height: 1.5em;
		}
		.leaflet-fusesearch-panel {
			position: relative;
			top: 2%;
			left: 50%;
			z-index: 1000;
			width: 300px;
		}
		.leaflet-fusesearch-panel .content {
			background-color: white;
			box-shadow: 1px grey;
			/*padding-left: 25px;*/
		}
		.leaflet-fusesearch-panel .content .search-input {
			width: 98%;
			font-size: 1.3em;
			outline: none;
			box-shadow: 1px 1px 1px 1px grey;
		}
		.leaflet-fusesearch-panel .content a {
			display: none;
		}
		.leaflet-fusesearch-panel .content p {
			margin-left: 10px;
			margin-right: 10px;
		}
	</style>
</head>
<body>
	<div id="mapid"></div>
</body>
<script type="text/javascript">
	var mymap = L.map('mapid').setView([30.505, -36], 2.5);
	var international, state, local, internationalSearch, stateSearch, localSearch;
	// var mymap = L.map('mapid').setView([30.505, -36], 2.5);
	// var searchCtrl = L.control.fuseSearch()
	// searchCtrl.addTo(mymap);
	// console.log(searchCtrl)
	// var MAPSE = mymap.addControl( searchCtrl );
	// console.log(MAPSE)

	var myStyle = {
	    "color": "black",
	    "weight": 1,
	    "opacity": 0.8,
	    'fillColor': '#4679B2',
	    'fillOpacity': 0.7
	};
	var geoDatas = [{international: "https://rawgit.com/John123Yu/LeafletMapDataGov/master/international.geojson"}, {state: 'https://rawgit.com/John123Yu/LeafletMapDataGov/master/us_states.geojson'}, {local: 'https://rawgit.com/John123Yu/LeafletMapDataGov/master/us_cities_counties.geojson'}]

	var layer = new L.StamenTileLayer("toner-lite");
	var layer2 = L.tileLayer('http://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png', {
	    attribution: '<a href="http://www.openstreetmap.org/copyright">&#169; OpenStreetMap contributors</a>',
	    maxZoom: 15
	});
	mymap.addLayer(layer2);

	$.ajax({
		dataType: "json",
		url: "https://rawgit.com/John123Yu/LeafletMapDataGov/master/international.geojson",
		success: function(data) {
			internationalSearch = data;
		    international = L.geoJSON(data, {
			    style: myStyle,
			    onEachFeature: function(feature, layer) {
			    	feature.layer = layer;
				    layer.on({
				    	contextmenu: function(e){
				    		var popup = L.popup().setLatLng(e.latlng).setContent(feature.properties.Item  + "<br> Link: " + feature.properties.Link)
						    popup.openOn(mymap);
						},
	                    mouseover: function(e) {
	                    	layer.setStyle({
					            fillColor: 'orange',
					            fillOpacity: 0.6
					        })
	                    },
	                    mouseout: function (e) {
	                    	layer.setStyle({
					            fillColor: '#4679B2',
					            fillOpacity: 0.7
					        })
				        },
	                    click: function (e) {
				            window.open(feature.properties.Link,'_blank');
				        }
	                });
				}
			})
		}
	})

	$.ajax({
		dataType: "json",
		url: "https://rawgit.com/John123Yu/LeafletMapDataGov/master/us_states.geojson",
		success: function(data) {
			stateSearch = data;
		    state = L.geoJSON(data, {
			    style: myStyle,
			    onEachFeature: function(feature, layer) {
				    layer.on({
				    	contextmenu: function(e){
				    		var popup = L.popup().setLatLng(e.latlng).setContent(feature.properties.Item  + "<br> Link: " + feature.properties.Link)
						    popup.openOn(mymap);
						},
	                    mouseover: function(e) {
	                    	layer.setStyle({
					            fillColor: 'orange',
					            fillOpacity: 0.6
					        })
	                    },
	                    mouseout: function (e) {
	                    	layer.setStyle({
					            fillColor: '#4679B2',
					            fillOpacity: 0.7
					        })
				        },
	                    click: function (e) {
				            window.open(feature.properties.Link,'_blank');
				        }
	                });
				}
			})
		}
	})

	$.ajax({
		dataType: "json",
		url: "https://rawgit.com/John123Yu/LeafletMapDataGov/master/us_cities_counties.geojson",
		success: function(data) {
			localSearch = data;
		    local = L.geoJSON(data, {
			    style: myStyle,
			    onEachFeature: function(feature, layer) {
				    layer.on({
				    	contextmenu: function(e){
				    		var popup = L.popup().setLatLng(e.latlng).setContent(feature.properties.Item  + "<br> Link: " + feature.properties.Link)
						    popup.openOn(mymap);
						},
	                    mouseover: function(e) {
	                    	layer.setStyle({
					            fillColor: 'orange',
					            fillOpacity: 0.6
					        })
	                    },
	                    mouseout: function (e) {
	                    	layer.setStyle({
					            fillColor: '#4679B2',
					            fillOpacity: 0.7
					        })
				        },
	                    click: function (e) {
				            window.open(feature.properties.Link,'_blank');
				        }
	                });
				}
			})
		}
	})	
	setTimeout(function(){
		var baseMaps = {
		    "Text Map": layer,
		    'Geographic Map': layer2
		};
		var overlayMaps = {
		    "International": international,
		    "State": state,
		    "US Cities and Counties": local
		};
		mymap.addLayer(international);
		mymap.addLayer(state);
		mymap.addLayer(local);
		L.control.layers(baseMaps, overlayMaps).addTo(mymap);
	 }, 300);
	 setTimeout(function(){
		var searchCtrl = L.control.fuseSearch()
		searchCtrl.addTo(mymap);
		searchCtrl.indexFeatures(internationalSearch.features, ['Item', 'Link']);
	 }, 800);		
</script>
</html>