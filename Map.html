<!DOCTYPE html>
<html>
<head>
	<title>Data.gov Map of Open Government Websites</title>
	<link rel="stylesheet" href="./Leaflet/leaflet.css" />
	<link rel="stylesheet" href="./leaflet-search/src/leaflet-search.css" />
	<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
	<script src="./Leaflet/leaflet.js"></script>
	<script type="text/javascript" src="http://maps.stamen.com/js/tile.stamen.js?v1.3.0"></script>
	<script src="./leaflet-search/src/leaflet-search.js"></script>
	<script src="./data/international.js"></script>
	<script src="./data/us_states.js"></script>
	<script src="./data/us_cities_counties.js"></script>
	<style type="text/css">
		#mapid { 
			height: 650px; 
			width: 990px;
			border: 1px solid #333333;
		}
		.leaflet-popup-content {
			font-weight: bold;
			line-height: 1.5em;
		}
		/*.leaflet-marker-icon {
			display: none;
		}*/
	</style>
</head>
<body>
	<div id="mapid"></div>
</body>
<script type="text/javascript">
	var mymap = L.map('mapid').setView([40, 0], 1.5);
	var international, state, local;
	var myStyle = {
	    "color": "black",
	    "weight": 1,
	    "opacity": 0.8,
	    'fillColor': '#4679B2',
	    'fillOpacity': 0.8
	},
		blankStyle = {
			opacity: 0,
			fillOpacity: 0
	};
	var geoDatas = [{international: internationalGeoJson}, {state: statesGeoJson}, {local: localGeoJson}]

	var layer = new L.StamenTileLayer("toner-lite");
	var layer2 = L.tileLayer('http://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png', {
	    attribution: '<a href="http://www.openstreetmap.org/copyright">&#169; OpenStreetMap contributors</a>',
	    maxZoom: 15
	});
	mymap.addLayer(layer2);


	international = L.geoJSON(internationalGeoJson, {
	    style: myStyle,
	    onEachFeature: function(feature, layer) {
	    	layer.bindPopup('<h3>'+ feature.properties.Item +'</h3>' + "<h4>" + "<a target='blank' href='"+feature.properties.Link+"'>"+feature.properties.Link+"</a><h4>" );
		    layer.on({
                contextmenu: function(e){
		    		var popup = L.popup().setLatLng(e.latlng).setContent('<h3>'+ feature.properties.Item +'</h3>' + "<h4>" + "<a target='blank' href='"+feature.properties.Link+"'>"+feature.properties.Link+"</a><h4>")
				    popup.openOn(mymap);
				},
				mouseover: function(e) {
                	if(layer.setStyle){
	                	layer.setStyle({
				            fillColor: 'orange',
				            fillOpacity: 0.7
				        })
                	}
                },
				mouseout: function (e) {
                	if(layer.setStyle){
	                	layer.setStyle({
				            fillColor: '#4679B2',
				            fillOpacity: .8
				        })
                	}
		        },
		        click: function (e) {
		            window.open(feature.properties.Link,'_blank');
		        }
            });
		}
	})

	state = L.geoJSON(statesGeoJson, {
	    style: myStyle,
	    onEachFeature: function(feature, layer) {
	    	layer.bindPopup('<h3>'+ feature.properties.Item +'</h3>' + "<h4>" + "<a target='blank' href='"+feature.properties.Link+"'>"+feature.properties.Link+"</a><h4>" );
		    layer.on({
                contextmenu: function(e){
		    		var popup = L.popup().setLatLng(e.latlng).setContent('<h3>'+ feature.properties.Item +'</h3>' + "<h4>" + "<a target='blank' href='"+feature.properties.Link+"'>"+feature.properties.Link+"</a><h4>")
				    popup.openOn(mymap);
				},
				mouseover: function(e) {
                	if(layer.setStyle){
	                	layer.setStyle({
				            fillColor: 'orange',
				            fillOpacity: 0.7
				        })
                	}
                },
				mouseout: function (e) {
                	if(layer.setStyle){
	                	layer.setStyle({
				            fillColor: '#4679B2',
				            fillOpacity: 0.8
				        })
                	}
		        },
		        click: function (e) {
		            window.open(feature.properties.Link,'_blank');
		        }
            });
		}
	})

	local = L.geoJSON(localGeoJson, {
	    style: myStyle,
	    onEachFeature: function(feature, layer) {
	    	layer.bindPopup('<h3>'+ feature.properties.Item +'</h3>' + "<h4>" + "<a target='blank' href='"+feature.properties.Link+"'>"+feature.properties.Link+"</a></h4>" );
		    layer.on({
                contextmenu: function(e){
		    		var popup = L.popup().setLatLng(e.latlng).setContent('<h3>'+ feature.properties.Item +'</h3>' + "<h4>" + "<a target='blank' href='"+feature.properties.Link+"'>"+feature.properties.Link+"</a><h4>")
				    popup.openOn(mymap);
				},
				mouseover: function(e) {
                	if(layer.setStyle){
	                	layer.setStyle({
				            fillColor: 'orange',
				            fillOpacity: 0.7
				        })
                	}
                },
				mouseout: function (e) {
                	if(layer.setStyle){
	                	layer.setStyle({
				            fillColor: '#4679B2',
				            fillOpacity: 0.8
				        })
                	}
		        },
		        click: function (e) {
		            window.open(feature.properties.Link,'_blank');
		        }
            });
		}
	})

	var allGeoJson = L.geoJson([internationalGeoJson, localGeoJson, statesGeoJson], {
		style: blankStyle,
		onEachFeature: function(feature, layer) {
			if(layer.setOpacity) {
				layer.setOpacity(0)
			}
			layer.bindPopup('<h3>'+ feature.properties.Item +'</h3>' + "<h4>" + "<a target='blank' href='"+feature.properties.Link+"'>"+feature.properties.Link+"</a><h4>" );
			layer.on({
				contextmenu: function(e){
		    		var popup = L.popup().setLatLng(e.latlng).setContent('<h3>'+ feature.properties.Item +'</h3>' + "<h4>" + "<a target='blank' href='"+feature.properties.Link+"'>"+feature.properties.Link+"</a><h4>")
				    popup.openOn(mymap);
				},
				mousemove: function(e){
					var id = setTimeout(function(){ 
						var popup = L.popup().setLatLng(e.latlng).setContent('<h3>'+ feature.properties.Item +'</h3>' + "<h4>" + "<a target='blank' href='"+feature.properties.Link+"'>"+feature.properties.Link+"</a><h4>")
					    popup.openOn(mymap);	
					}, 650);
					while (id--) {
					    window.clearTimeout(id);
					}
				},
				mouseover: function(e) {
                	if(layer.setStyle){
	                	layer.setStyle({
				            fillColor: 'orange',
				            fillOpacity: 0.7
				        })
                	}
                },
				mouseout: function (e) {
					if(layer.setStyle){
	                	layer.setStyle({
				            fillColor: '#4679B2',
				            fillOpacity: 0
				        })
					}
		        },
		        click: function (e) {
		            window.open(feature.properties.Link,'_blank');
		        }
            });
		}
	});
	console.log(allGeoJson)
	var baseMaps = {
	    "Text Map": layer,
	    'Geographic Map': layer2
	};
	var overlayMaps = {
	    "International": international,
	    "State": state,
	    "US Cities and Counties": local
	};
	mymap.addLayer(international);
	mymap.addLayer(state);
	mymap.addLayer(local);
	L.control.layers(baseMaps, overlayMaps).addTo(mymap);


	var searchControl = new L.Control.Search({
		moveToLocation: function(latlng, title, map) {
			if(latlng.layer.getBounds){
				var zoom = map.getBoundsZoom(latlng.layer.getBounds());
			} else {
				var zoom = 7;
			}
  			map.setView(latlng, zoom); // access the zoom
		},
		position: 'topright',
		layer: allGeoJson,
		propertyName: 'Item',
		marker: false
	}).on('search:locationfound', function(e) {
		if(e.layer.setStyle){
			e.layer.setStyle({fillColor: 'orange', fillOpacity: .6});
		}
		if(e.layer._popup){
			e.layer.openPopup();
		}
	})
	mymap.addControl( searchControl );
	local.bringToFront();
	mymap.on("overlayadd", function (event) {
	  allGeoJson.bringToFront();
	  local.bringToFront();
	});

	$(window).on("resize", function() {
	    $("#mapid").height($(window).height()*.8).width($(window).width()*.8);
	    mymap.invalidateSize();
	}).trigger("resize");


</script>
</html>